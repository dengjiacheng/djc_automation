部署步骤

连接设备
adb start-server
adb connect 192.168.0.111:5555
adb connect 192.168.0.109:5555
adb devices （确认列表里出现 192.168.0.109:5555）

安装  控制APK
./gradlew auth-app:assembleDebug
adb -s 192.168.0.115:5555 install -r auth-app/build/outputs/apk/debug/auth-app-debug.apk

adb -s 192.168.0.112:5555 uninstall com.automation

编译 测试APK
./gradlew automation-app:assembleDebug
./gradlew automation-app:assembleDebugAndroidTest



python scripts/build_and_upload.py --server http://120.26.211.209 --username admin --password admin123

adb -s 192.168.0.111:5555  shell ime enable com.automation/.AdbKeyboard


安装 测试 主APK
adb install -r -t automation-app/build/outputs/apk/debug/automation-app-debug.apk

安装 instrumentation 测试 APK
adb install -r -t automation-app/build/outputs/apk/androidTest/debug/automation-app-debug-androidTest.apk

（可选）手动触发测试
如果想直接从命令行拉起测试：
adb shell su -c "am instrument -w -r -e wsUrl <你的ws地址> com.automation.test/androidx.test.runner.AndroidJUnitRunner"
平时只需在设备上打开控制台 App（新的 MainActivity）点击“登录并启动测试”。


验证一下可以在命令行里观察：
adb shell ps | grep com.automation        # 启动前
adb shell su -c "am instrument …"        # 启动测试
adb shell ps | grep com.automation        # 会看到主进程被杀，出现 instrumentation 进程


adb logcat | grep AutomationTest



adb uninstall com.automation.test
adb uninstall com.automation
adb shell pm path com.automation.test

adb -s 192.168.0.111:5555 uninstall com.automation
logcat

$ bash -lc 'adb -s 192.168.0.111:5555 shell '"'"'logcat -d | grep "注册脚本能力失败"'"'"

$ bash -lc 'adb -s 192.168.0.111:5555 shell '"'"'logcat -d | grep "列举脚本能力失败"'"'"

$ bash -lc 'adb -s 192.168.0.111:5555 shell '"'"'grep "CommandExecutionEngine" /storage/emulated/0/Android/data/com.automation.auth/files/logs/automation.log'"'"
grep: /storage/emulated/0/Android/data/com.automation.auth/files/logs/automation.log: No such file or directory
adb connect 192.168.0.115:5555

adb -s 192.168.0.115:5555 shell pm path com.automation.test

adb  -s 192.168.0.115:5555 logcat -s CommandBus ParameterValidator ScenarioParamBinder ScenarioTaskService ScenarioRunCoord ScenarioRunner ScenarioEngine AutomationController DhgateOrderHandlers

{
  "action": "start_task",
  "params": {
    "task_name": "dhgate_order_v2",
    "config": {
      "search_keyword": "demo keyword",
      "product_image": {
        "value": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/xcAAvoB9p7N9W4AAAAASUVORK5CYII=",
        "source": "base64",
        "mime": "image/png"
      },
      "target_product_title": "demo title"
    }
  }
}


taskName=dhgate_order_v2


adb logcat -s CommandBus ParameterValidator ScenarioParamBinder ScenarioTaskService ScenarioRunCoord ScenarioRunner ScenarioEngine AutomationController DhgateOrderHandlers
